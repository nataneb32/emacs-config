;;;; people-marketing-api.lisp

(in-package #:people-marketing-api)

(defvar *server* (make-instance 'easy-routes:routes-acceptor :port 3000))

(defun start ()
  (hunchentoot:start *server*))

(defun stop()
  (hunchentoot:stop *server*))

(defun start-and-block ()
  (start)
  (handler-case (bt:join-thread (find-if (lambda (th)
                                           (search "hunchentoot" (bt:thread-name th)))
                                         (bt:all-threads)))
    ;; Catch a user's C-c
    (#+sbcl sb-sys:interactive-interrupt
     #+ccl  ccl:interrupt-signal-condition
     #+clisp system::simple-interrupt-condition
     #+ecl ext:interactive-interrupt
     #+allegro excl:interrupt-signal
     () (progn
          (format *error-output* "Aborting.~&")
          (stop)
          (uiop:quit)))
    (error (c) (format t "Woops, an unknown error occured:~&~a~&" c))))
